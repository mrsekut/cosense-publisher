# yaml-language-server: $schema=https://json.schemastore.org/github-workflow.json

# 基本は使わない
# デバッグ時やフルでプロジェクトを更新したい際に、publisherの実行前に実行する
name: Clear Cache

on:
  workflow_dispatch:

permissions:
  actions: write

jobs:
  clear-cache:
    runs-on: ubuntu-latest
    steps:
      - name: List caches (before)
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "=== Caches before deletion ==="
          gh cache list --repo ${{ github.repository }}

      - name: Delete last_import cache
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: gh cache delete last-import-time --repo ${{ github.repository }} || true

      - name: List caches (after)
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "=== Caches after deletion ==="
          gh cache list --repo ${{ github.repository }}
